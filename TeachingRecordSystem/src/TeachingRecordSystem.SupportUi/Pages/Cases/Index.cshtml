@page "/cases"
@model TeachingRecordSystem.SupportUi.Pages.Cases.IndexModel
@{
    ViewBag.Title = "Open Cases";
}

<table class="govuk-table">
    <caption class="govuk-table__caption govuk-table__caption--xl">@ViewBag.Title</caption>
    <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header govuk-!-width-one-quarter">Case reference</th>
            <th scope="col" class="govuk-table__header govuk-!-width-one-third">Name</th>
            <th scope="col" class="govuk-table__header govuk-!-width-one-quarter">Case type</th>
            <th scope="col" class="govuk-table__header">Created on</th>
        </tr>
    </thead>
    <tbody class="govuk-table__body">
        @if (Model.Cases!.Length == 0)
        {
            <tr class="govuk-table__row" data-testid="no-cases">
                 <td class="govuk-table__cell" colspan="4">No cases</td>
            </tr>
        }
        else
        {
            @foreach (var caseInfo in Model.Cases!)
            {
                <tr class="govuk-table__row" data-testid="case-@caseInfo.CaseReference">
                    <td class="govuk-table__cell" data-testid="case-reference-@caseInfo.CaseReference"><a href="@LinkGenerator.EditCase(caseInfo.CaseReference)" class="govuk-link">@caseInfo.CaseReference</a></td>
                    <td class="govuk-table__cell" data-testid="name-@caseInfo.CaseReference">@caseInfo.Customer</td>
                    <td class="govuk-table__cell" data-testid="case-type-@caseInfo.CaseReference">@caseInfo.CaseType</td>
                    <td class="govuk-table__cell" data-testid="created-on-@caseInfo.CaseReference">@caseInfo.CreatedOn.ToString("dd/MM/yyyy")</td>
                </tr>
            }
        }        
    </tbody>
</table>

@if (Model.TotalKnownPages > 1)
{
    <govuk-pagination>
        @if (Model.PreviousPage.HasValue)
        {
            <govuk-pagination-previous asp-page="Index" asp-route-pagenumber="@Model.PreviousPage" />
        }

        @if (Model.DisplayPageNumbers)
        {
            @for (int i = 0; i < Model.PaginationPages!.Length; i++)
            {
                var item = Model.PaginationPages[i];

                if (i > 0 && Model.PaginationPages[i - 1] != item - 1)
                {
                    <govuk-pagination-ellipsis />
                }

                <govuk-pagination-item asp-page="Index" asp-route-pagenumber="@item" is-current="@(item == Model.PageNumber)">@item</govuk-pagination-item>
            }
        }        

        @if (Model.NextPage.HasValue)
        {
            <govuk-pagination-next asp-page="Index" asp-route-pagenumber="@Model.NextPage" />
        }
    </govuk-pagination>
}
