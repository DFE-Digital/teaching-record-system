@using TeachingRecordSystem.Core.Events
@model TimelineItem<TimelineEvent<TeachingRecordSystem.Core.Events.Legacy.MandatoryQualificationCreatedEvent>>
@{
    var createdEvent = Model.ItemModel.Event;
    var mandatoryQualification = createdEvent.MandatoryQualification;
}

<div class="moj-timeline__item govuk-!-padding-bottom-2" data-testid="timeline-item-mq-created-event">
    <div class="moj-timeline__header">
        <h2 class="moj-timeline__title">Mandatory qualification added</h2>
    </div>
    <p class="moj-timeline__date">
        <span data-testid="raised-by">By @Model.ItemModel.RaisedByUser.Name on</span>
        <time datetime="@Model.Timestamp.ToString("O")" data-testid="timeline-item-time">@Model.FormattedTimestamp</time>
    </p>

    <div class="moj-timeline__description">
        <govuk-summary-list>
            <govuk-summary-list-row>
                <govuk-summary-list-row-key>Training provider</govuk-summary-list-row-key>
                <govuk-summary-list-row-value data-testid="provider">@(mandatoryQualification.Provider?.Name ?? mandatoryQualification.Provider?.DqtMqEstablishmentName ?? "None")</govuk-summary-list-row-value>
            </govuk-summary-list-row>
            <govuk-summary-list-row>
                <govuk-summary-list-row-key>Specialism</govuk-summary-list-row-key>
                <govuk-summary-list-row-value data-testid="specialism">@(mandatoryQualification.Specialism?.GetTitle() ?? "None")</govuk-summary-list-row-value>
            </govuk-summary-list-row>
            <govuk-summary-list-row>
                <govuk-summary-list-row-key>Start date</govuk-summary-list-row-key>
                <govuk-summary-list-row-value data-testid="start-date">@(mandatoryQualification.StartDate?.ToString(WebConstants.DateOnlyDisplayFormat) ?? "None")</govuk-summary-list-row-value>
            </govuk-summary-list-row>
            <govuk-summary-list-row>
                <govuk-summary-list-row-key>Status</govuk-summary-list-row-key>
                <govuk-summary-list-row-value data-testid="status">@(mandatoryQualification.Status?.GetTitle() ?? "None")</govuk-summary-list-row-value>
            </govuk-summary-list-row>
            <govuk-summary-list-row>
                <govuk-summary-list-row-key>End date</govuk-summary-list-row-key>
                <govuk-summary-list-row-value data-testid="end-date">@(mandatoryQualification.EndDate?.ToString(WebConstants.DateOnlyDisplayFormat) ?? "None")</govuk-summary-list-row-value>
            </govuk-summary-list-row>
        </govuk-summary-list>

        <govuk-details class="govuk-!-margin-bottom-2">
            <govuk-details-summary>Reason for adding mandatory qualification</govuk-details-summary>
            <govuk-details-text>
                <govuk-summary-list>
                    <govuk-summary-list-row>
                        <govuk-summary-list-row-key>Reason</govuk-summary-list-row-key>
                        <govuk-summary-list-row-value data-testid="reason" use-empty-fallback>@createdEvent.AddReason</govuk-summary-list-row-value>
                    </govuk-summary-list-row>
                    <govuk-summary-list-row>
                        <govuk-summary-list-row-key>Additional information</govuk-summary-list-row-key>
                        <govuk-summary-list-row-value data-testid="reason-detail" use-empty-fallback>
                            @Html.ConvertNewlinesToLineBreaks(createdEvent.AddReasonDetail)
                        </govuk-summary-list-row-value>
                    </govuk-summary-list-row>
                    <govuk-summary-list-row>
                        <govuk-summary-list-row-key>Evidence</govuk-summary-list-row-key>
                        <govuk-summary-list-row-value data-testid="evidence">
                            <vc:event-evidence-file-link evidence-file="@createdEvent.EvidenceFile" />
                        </govuk-summary-list-row-value>
                    </govuk-summary-list-row>
                </govuk-summary-list>
            </govuk-details-text>
        </govuk-details>
    </div>
</div>
